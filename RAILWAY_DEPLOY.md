# üöÇ Guide de D√©ploiement sur Railway

Ce guide vous explique comment d√©ployer l'application **Gestion des Salles** sur Railway.app avec **docker-compose.yml complet** (incluant la base de donn√©es PostgreSQL dans Docker).

## ‚ú® Pourquoi Railway ?

‚úÖ **Supporte docker-compose nativement** - D√©ploie tous vos conteneurs Docker  
‚úÖ **Base de donn√©es dans Docker** - Utilise le conteneur PostgreSQL de votre docker-compose.yml  
‚úÖ **D√©ploiement automatique** - Git push = d√©ploiement automatique  
‚úÖ **Plan gratuit** - $5 de cr√©dit gratuit chaque mois  
‚úÖ **Facile** - Configuration en 5 minutes  

## üìã Pr√©requis

- Un compte GitHub avec le code du projet
- Un compte Railway.app (gratuit) : https://railway.app

---

## üöÄ √âtapes de d√©ploiement

### √âtape 1Ô∏è‚É£ : Cr√©er un compte Railway

1. Allez sur **https://railway.app**
2. Cliquez sur **"Login"** puis **"Login with GitHub"**
3. Autorisez Railway √† acc√©der √† votre compte GitHub
4. Vous recevez **$5 de cr√©dit gratuit** chaque mois ! üéÅ

### √âtape 2Ô∏è‚É£ : Cr√©er un nouveau projet

1. Sur le **Dashboard Railway**, cliquez sur **"New Project"**
2. S√©lectionnez **"Deploy from GitHub repo"**
3. Choisissez votre repository **`devops_tp3`** (ou le nom de votre repo)
4. Railway va automatiquement d√©tecter votre `docker-compose.yml` ! üéâ

### √âtape 3Ô∏è‚É£ : Configuration des services

Railway va automatiquement cr√©er **3 services** depuis votre docker-compose.yml :

#### Service 1 : Base de donn√©es PostgreSQL (`db`)
- ‚úÖ Conteneur Docker avec l'image `postgres:15-alpine`
- ‚úÖ Volume persistant pour les donn√©es
- ‚úÖ Script d'initialisation `init.sql` ex√©cut√© automatiquement
- ‚ö†Ô∏è **Pas de port expos√© publiquement** (s√©curis√©, accessible uniquement en interne)

#### Service 2 : Backend PHP (`backend`)
- ‚úÖ Construit depuis `backend/Dockerfile`
- ‚úÖ Connect√© √† la base de donn√©es via le r√©seau interne
- ‚úÖ Port expos√© publiquement pour l'API

#### Service 3 : Frontend React (`frontend`)
- ‚úÖ Construit depuis `frontend/Dockerfile`
- ‚úÖ Port expos√© publiquement pour l'interface utilisateur

### √âtape 4Ô∏è‚É£ : Ajuster les variables d'environnement

Railway utilise votre docker-compose.yml, mais vous devez v√©rifier/ajuster quelques variables :

#### Pour le **Backend** :

1. Cliquez sur le service **backend** dans Railway
2. Allez dans l'onglet **"Variables"**
3. V√©rifiez que ces variables existent (elles sont normalement auto-d√©tect√©es) :
   ```
   DB_HOST=db
   DB_NAME=gestion_salles
   DB_USER=postgres
   DB_PASSWORD=postgres
   ```

#### Pour le **Frontend** :

1. Cliquez sur le service **frontend** dans Railway
2. Allez dans l'onglet **"Variables"**
3. **IMPORTANT** : Modifiez `REACT_APP_API_URL` :
   
   ```
   REACT_APP_API_URL=https://VOTRE-BACKEND-URL.railway.app/api
   ```
   
   üîç Pour obtenir l'URL du backend :
   - Cliquez sur le service **backend**
   - Allez dans **"Settings"**
   - Copiez l'URL sous **"Domains"**
   - Ajoutez `/api` √† la fin

   Exemple : `https://gestion-salles-backend-production.up.railway.app/api`

### √âtape 5Ô∏è‚É£ : Exposer les services publiquement

Par d√©faut, Railway n'expose pas les ports publiquement. Vous devez le faire manuellement :

#### Exposer le Backend :

1. Cliquez sur le service **backend**
2. Allez dans **"Settings"**
3. Scrollez jusqu'√† **"Networking"**
4. Cliquez sur **"Generate Domain"**
5. Railway va cr√©er une URL comme : `https://gestion-salles-backend-production.up.railway.app`

#### Exposer le Frontend :

1. Cliquez sur le service **frontend**
2. Allez dans **"Settings"**
3. Scrollez jusqu'√† **"Networking"**
4. Cliquez sur **"Generate Domain"**
5. Railway va cr√©er une URL comme : `https://gestion-salles-frontend-production.up.railway.app`

‚ö†Ô∏è **N'exposez PAS la base de donn√©es** - Elle doit rester priv√©e et accessible uniquement en interne.

### √âtape 6Ô∏è‚É£ : Red√©ployer le frontend

Apr√®s avoir modifi√© `REACT_APP_API_URL` √† l'√©tape 4 :

1. Retournez sur le service **frontend**
2. Allez dans l'onglet **"Deployments"**
3. Cliquez sur le menu **‚ãÆ** du dernier d√©ploiement
4. S√©lectionnez **"Redeploy"**
5. Attendez 3-5 minutes que le build se termine

### √âtape 7Ô∏è‚É£ : V√©rifier que tout fonctionne

#### Test 1 : API Backend
Ouvrez dans votre navigateur :
```
https://VOTRE-BACKEND-URL.railway.app/api/health
```

R√©sultat attendu :
```json
{"status":"OK","message":"API de gestion des salles"}
```

#### Test 2 : Liste des salles
```
https://VOTRE-BACKEND-URL.railway.app/api/salles
```

R√©sultat attendu : Vous devriez voir les 4 salles de test (A101, B202, etc.) üéâ

#### Test 3 : Frontend
Ouvrez dans votre navigateur :
```
https://VOTRE-FRONTEND-URL.railway.app
```

R√©sultat attendu : L'interface de gestion des salles s'affiche ! üé®

---

## üèóÔ∏è Architecture sur Railway

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Railway Project                    ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Service: frontend (React)           ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  Port: 3000                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  URL: https://...railway.app         ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                  ‚îÇ Appelle                  ‚îÇ
‚îÇ                  ‚ñº                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Service: backend (PHP)              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  Port: 80                            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  URL: https://...railway.app/api     ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                  ‚îÇ Se connecte              ‚îÇ
‚îÇ                  ‚ñº                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Service: db (PostgreSQL)            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  Port: 5432 (interne uniquement)     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  Conteneur Docker avec volume        ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ  R√©seau interne Railway                     ‚îÇ
‚îÇ  Communication entre services par nom        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìä Comment Railway g√®re docker-compose.yml

Railway lit votre `docker-compose.yml` et :

1. ‚úÖ **Cr√©e un service par conteneur** d√©fini dans le compose
2. ‚úÖ **Build les Dockerfiles** automatiquement
3. ‚úÖ **Configure le r√©seau interne** - Les services communiquent par leur nom (`db`, `backend`, `frontend`)
4. ‚úÖ **G√®re les volumes** - Les donn√©es PostgreSQL sont persist√©es
5. ‚úÖ **Applique les variables d'environnement** du compose
6. ‚úÖ **Ex√©cute init.sql** automatiquement au d√©marrage de PostgreSQL

**Votre base de donn√©es PostgreSQL tourne bien dans un conteneur Docker sur Railway, pas en local ! üê≥**

## üîÑ D√©ploiement continu

Une fois configur√©, chaque `git push` sur votre branche `main` d√©clenchera automatiquement :

1. üîÑ Railway d√©tecte le push GitHub
2. üèóÔ∏è Build des nouveaux Dockerfiles si modifi√©s
3. üöÄ Red√©ploiement automatique
4. ‚úÖ Application mise √† jour en ~5 minutes

```bash
# Sur votre machine locale
git add .
git commit -m "Update application"
git push origin main

# Railway red√©ploie automatiquement ! üéâ
```

## üí∞ Co√ªts Railway

### Plan Gratuit (Hobby)
- **$5 de cr√©dit gratuit** chaque mois
- Suffisant pour ce projet en d√©veloppement
- Les services s'endorment apr√®s inactivit√© (comme Render)

### Consommation estim√©e pour ce projet :
- Frontend : ~$1-2/mois
- Backend : ~$1-2/mois  
- PostgreSQL : ~$1-2/mois
- **Total : ~$3-6/mois** (dans votre cr√©dit gratuit !)

### Plan Pro ($20/mois)
- Pas de mise en veille
- Plus de ressources
- Support prioritaire

## ‚öôÔ∏è Configuration avanc√©e

### Modifier les ressources allou√©es

Pour chaque service, dans **Settings** :
- **Memory** : 512 MB par d√©faut (suffisant)
- **CPU** : Partag√© (suffisant pour le plan gratuit)

### Voir les logs en temps r√©el

1. Cliquez sur un service
2. Allez dans l'onglet **"Deployments"**
3. Cliquez sur le d√©ploiement actif
4. Les logs s'affichent en temps r√©el üìä

### Acc√©der √† la base de donn√©es

Railway ne fournit pas de shell web pour PostgreSQL, mais vous pouvez :

#### Option 1 : Utiliser Railway CLI

```bash
# Installer Railway CLI
npm install -g @railway/cli

# Se connecter
railway login

# Se connecter √† la base de donn√©es
railway connect postgres
```

#### Option 2 : Connexion locale avec les credentials

1. Dans le service **db**, allez dans **"Variables"**
2. Notez les credentials PostgreSQL
3. Utilisez un client comme **pgAdmin** ou **DBeaver**

## üêõ D√©pannage

### Le frontend ne se connecte pas au backend

**Solution** : V√©rifiez que `REACT_APP_API_URL` pointe vers la bonne URL du backend.

1. Copiez l'URL du backend depuis **Settings** > **Domains**
2. Mettez √† jour la variable dans le frontend : `https://votre-backend.railway.app/api`
3. Red√©ployez le frontend

### La base de donn√©es ne s'initialise pas

**Solution** : Le script `init.sql` devrait s'ex√©cuter automatiquement. Si ce n'est pas le cas :

1. Connectez-vous via Railway CLI : `railway connect postgres`
2. Ex√©cutez manuellement le contenu de `backend/init.sql`

### Erreur "out of memory"

**Solution** : Le plan gratuit a des limites de m√©moire.

1. Optimisez vos Dockerfiles (d√©j√† fait avec alpine)
2. Ou passez au plan Pro

### Les services s'endorment

Avec le plan gratuit, les services s'endorment apr√®s ~15 minutes d'inactivit√©.

**Solutions** :
- Utilisez un service de ping (UptimeRobot)
- Passez au plan Pro ($20/mois)

## üîó Liens utiles

- [Documentation Railway](https://docs.railway.app)
- [Railway CLI](https://docs.railway.app/develop/cli)
- [Railway Community](https://discord.gg/railway)
- [Pricing Railway](https://railway.app/pricing)

## ‚úÖ Checklist de d√©ploiement

- [ ] Compte Railway cr√©√© et connect√© √† GitHub
- [ ] Projet cr√©√© depuis le repository GitHub
- [ ] 3 services d√©tect√©s automatiquement (db, backend, frontend)
- [ ] Variables d'environnement v√©rifi√©es pour le backend
- [ ] URL du backend copi√©e
- [ ] Variable `REACT_APP_API_URL` mise √† jour dans le frontend
- [ ] Domaines g√©n√©r√©s pour backend et frontend
- [ ] Frontend red√©ploy√© apr√®s modification des variables
- [ ] Test `/api/health` : ‚úÖ OK
- [ ] Test `/api/salles` : ‚úÖ Retourne les salles
- [ ] Frontend accessible et fonctionnel
- [ ] Test CRUD complet : Cr√©er/Lire/Modifier/Supprimer une salle

## üéâ Application d√©ploy√©e !

Votre application compl√®te (avec base de donn√©es PostgreSQL dans Docker) est maintenant d√©ploy√©e sur Railway !

**URLs finales :**
- Frontend : `https://gestion-salles-frontend-production.up.railway.app`
- Backend : `https://gestion-salles-backend-production.up.railway.app/api`
- Base de donn√©es : Conteneur Docker priv√© (accessible uniquement en interne)

**La base de donn√©es PostgreSQL tourne dans un conteneur Docker sur Railway, exactement comme votre docker-compose.yml local ! üê≥üéØ**

---

**Bon d√©ploiement ! üöÇüöÄ**

